## Шаг 2. Портирование. Запуск программы на NMC 


Рассмотрим два варианта портирование проекта под плату МС77.07
- standalone-приложение - полностью nmc-приложение. Приложение обрабатывает одно изображение и записывает на диск в pgm-формате . Приложение целиком независимое и не требует хостовой части.
- приложение с хостовой частью. Чтение и запис 

### Создание standalone-приложения


тение и запись входно и выходго изображения в файле и завершает работу.

### Создание приложения с хостовой частью. 

Проект будет состоят из двух частей - хостовой /mb7707/pc и целевой /mb7707/nm. 
Хостовая часть необходима для:
- загрузки исполняемого nmc-кода на МС77.07 
- чтения  файла src.bmp
- загрузки изображения на плату
- считывание результата обработки с платы 
- сохранения результата в dst.bmp

Целевая часть ждет получения изображения от хоста и обрабатывает его фильтром Собеля 

Общие файлы, которые также используются в других сборках , например для мс5103 или целиком модели на хосте,
лежат в корне папки /step02_easybmp_risc
#### Создаем nmc-приложение
в Makefile  указываем необходимые пути к заголовочным файлам и библиотекам
'''
INC_DIRS         = -I"$(NEURO)/include" -I../..  -I"$(MB7707)/nm/include" -I"$(NMPP)/include"
LIB_DIRS         = -L"$(NEURO)/lib" -L"$(MB7707)/nm/lib" -L"$(NMPP)/lib"
'''
- $(NEURO) - путь к NMSDK
- $(MB7707)- путь к библиотеке загрузки и обмена для платы МС77.07 

указываем библиотеки
'''
LIBS             = libint_soc.lib mb7707lib.lib libc05.lib cppnew05.lib nmpp_nmc3.lib
'''
исходники указываются в виде путей, все имеющиеся c и cpp файлы в этих каталогах будут автоматически подключены в проект
'''
SRC_DIRS         = . ../.. 
'''

#### Создаем host-приложение
Аналогично прописываем пути в Makefile для хост приложения
'''
INC_DIRS         = -I"$(MB7707)/pc/include" -I$(ROOT)/deps/connector -I$(ROOT)/deps/EasyBMP
LIB_DIRS         = -L"$(MB7707)/pc/lib"
SRC_DIRS         = .. $(ROOT)/deps/EasyBMP
LIBS             = mb7707load.lib
'''
Работу с bmp файлами осуществляем через библиотеку EasyBMP
Доступ к плате для удобства осуществляется через класс C_PC_Connector_mb7707 , на вход конструктора которого необходимо передать имя исполняемого плата и MAC адрес сетевого контролера к которому подсоединена плата 

Для унификации работы с динамической памятью как на хосте так и nmc , мы вынуждены стандартный вызов malloc  обернуть в функцию malloc32 , в которой размер передается в 32-разрядных словах. 
Дело в том что malloc на хосте принимает размер в байтах, а на стороне nmc- в 32р.-словах. Для того чтобы sobel.cpp можно собирать на обоих платформах в дальнейшем мы будем использовать malloc32.

Запуск программы осуществляется через make run их папки mb7707/pc/make_vs08 , mb7707/pc/make_vs13 или  mb7707/pc/gcc в заисимости от вашего ПО.
В результате исполнения в этой же папке должен появиться dst.bmp

Производительность: 
- 1203625826 clocks per frame 
- 14247 clocks per pixel
- 0.265863 fps




 



